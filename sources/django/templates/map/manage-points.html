{% extends "map/views-manager.html" %}

{% block views-manager-child %}

<p>Points Management</p>
<div id="map_canvas" style="width:800px; height:500px"></div>
<div id="point-editing-zone"></div>

<div id="editingPointHtmlData" style="display: none;">{{editingPointHtmlData}}</div>
<div id="addingPointHtmlData" style="display: none;">{{addingPointHtmlData}}</div>

<script type="text/javascript"
	src="http://maps.googleapis.com/maps/api/js?v=3.exp&sensor=false">
</script>

<script type="text/javascript">
	// To be filled on server side
	var pointsData = [] ;

	var pointEditor = {
		showEditor: function (pointId) {
			var point = null;
			pointsData.forEach(function(entry) {
				if (entry.id == pointId)
					point = entry;
			});

			if (point == null)
				return;

			$( "div#point-editing-zone" ).html($( "div#editingPointHtmlData" ).html());
			$( "div#point-editing-zone" ).find( "#id_maplerId" ).val(pointId);

			$( "div#point-editing-zone" ).find( "#id_latitude" ).val(point.latitude);
			$( "div#point-editing-zone" ).find( "#id_longitude" ).val(point.longitude);
			$( "div#point-editing-zone" ).find( "#id_description" ).val(point.description);
			$( "div#point-editing-zone" ).find( "a#delete-point-button" ).attr('href', '/map/delete-point/' + point.id +'/');

		},
		showAddingForm: function (latitude, longitude) {
			$( "div#point-editing-zone" ).html($( "div#addingPointHtmlData" ).html());
			$( "div#point-editing-zone" ).find( "input#id_latitude" ).val(latitude);
			$( "div#point-editing-zone" ).find( "input#id_longitude" ).val(longitude);
		}
	}

	function loadPointsData(callback) {
	$.getJSON( "/data/points-by-user/{{userName}}/", function( data ) {
		pointsData = data;
		callback();
	});

	}

	function getPointOnClickCallback(pointId) {
		pointEditor.showEditor(pointId);
	}

	function getMapOnClickCallback(latitude, longitude) {
		pointEditor.showAddingForm(latitude, longitude);
	}

</script>

<script type="text/javascript" src="/static/map/script/map_common.js"></script>

{% endblock views-manager-child %}
